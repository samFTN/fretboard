<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manche de Guitare Interactif</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            margin-top: 30px;
        }

        header h1 {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        header .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0px;
            margin-top: 0px;
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
        }

        .control-group {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .control-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        select {
            width: 100%;
            padding: 10px 12px;
            background-color: #f5f7fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            color: #333;
            font-size: 14px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        select:hover {
            border-color: #667eea;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .notes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        /* Grille des notes uniquement visible en mode custom */
        .control-panel.custom-mode #customNotesGroup {
    display: block;
}

        .control-panel.custom-mode #notesGrid {
    display: grid;
    grid-template-columns: repeat(6, 1fr); /* 12 notes sur 2 lignes */
    gap: 8px;
}

        .note-btn {
            padding: 10px 8px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #f5f7fa;
            color: #667eea;
            border: 2px solid #e0e0e0;
        }

        .note-btn:hover {
            transform: scale(1.05);
            border-color: #667eea;
        }

        .fretboard-container {

    background: transparent;
    border-radius: 0px;
    padding: 0%;
    margin-top: 40px;

    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;

}
#fretboard {

    width: 100%;
    height: auto;
    display: block;

}

        .fretboard-container svg {
            width: 100%;
            height: auto;
            max-width: 100%;
            display: block;
        }

        footer {
            margin-top: 10px;
            margin-bottom: 10px;
            padding: 20px 0;
            text-align: center;
            color: white;
        }

        footer p {
            margin: 0;
            font-size: 1em;
        }

        @media (max-width: 992px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 20px;
                font-size: 0.85em;
            }
            header h1 {
                font-size: 1.8em;
            }
            .control-panel {
                grid-template-columns: 1fr;
            }
            .control-group {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
           <h1>Fretboard Guitarisation™</h1>
<p class="subtitle">Explorez les notes, gammes et arpèges sur le manche.</p>
        </header>

        <div class="grid">
            <!-- Controls -->
            <div class="control-panel">

             <!-- Affichage -->
                <div class="control-group">
                    <label>Affichage</label>
                    <select id="modeSelect">
                        <option value="scale">Gammes</option>
                        <option value="arpeggio">Arpèges</option>
                        <option value="custom">Notes personnalisées</option>
                    </select>
                </div>

                <!-- Notation -->
                <div class="control-group">
                    <label>Notation</label>
                    <select id="notationSelect">
                        <option value="universal">Universel (C, D, E...)</option>
                        <option value="french">Français (Do, Ré, Mi...)</option>
                        <option value="degrees">Degrés (1, 2, 3...)</option>
                    </select>
                </div>

                <!-- Gammes -->
                <div class="control-group" id="scaleGroup">
                    <label>Gamme</label>
                    <select id="scaleSelect">
                        <option value="major">Majeure</option>
                        <option value="minor">Mineure</option>
                        <option value="harmoniqueMinor">Mineure Harmonique</option>
                        <option value="melodiqueMineur">Mineure Mélodique</option>
                        <option value="pentatonicMinor">Pentatonique Mineure</option>
                        <option value="pentatonicMajor">Pentatonique Majeure</option>
                        <option value="blues">Blues</option>
                    </select>
                </div>

                <!-- Arpèges -->
                <div class="control-group" id="arpeggioGroup" style="display: none;">
                    <label>Arpège</label>
                    <select id="arpeggioSelect">
                        <option value="major">Majeur</option>
                        <option value="minor">Mineur</option>
                        <option value="dominant7">Dominante 7</option>
                        <option value="maj7">Maj7</option>
                        <option value="min7">Min7</option>
                    </select>
                </div>

                <!-- Notes Personnalisées -->
                <div class="control-group" id="customNotesGroup" style="display: none;">
                    <label>Sélectionnez les notes</label>
                    <div class="notes-grid" id="notesGrid"></div>
                </div>

                <!-- Tonalité -->
                <div class="control-group" id="keyGroup">
                    <label>Tonalité</label>
                    <select id="keySelect">
                        <option value="C">C</option>
                        <option value="C#">C#</option>
                        <option value="D">D</option>
                        <option value="D#">D#</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F#</option>
                        <option value="G">G</option>
                        <option value="G#">G#</option>
                        <option value="A">A</option>
                        <option value="A#">A#</option>
                        <option value="B">B</option>
                    </select>
                </div>
            </div>

            <!-- Fretboard -->
            <div class="fretboard-container">
                <svg id="fretboard" width="100%" height="100%" viewBox="0 0 780 360" preserveAspectRatio="xMidYMid meet"></svg>
            </div>
        </div>

        <footer>
            <p>Samuel Ferton - École Guitarisation™</p>
        </footer>
    </div>

   <script>
    // State management
    const state = {
        notation: 'universal',
        mode: 'scale',
        selectedScale: 'major',
        selectedArpeggio: 'major', // <-- séparé de la gamme
        selectedKey: 'C',
        selectedNotes: ['C']
    };

    const noteNames = {
        universal: ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'],
        french: ['Do', 'Do#', 'Ré', 'Ré#', 'Mi', 'Fa', 'Fa#', 'Sol', 'Sol#', 'La', 'La#', 'Si']
    };

    const intervalToDegree = {
        0: '1', 1: 'b2', 2: '2', 3: 'b3', 4: '3', 5: '4',
        6: '#4', 7: '5', 8: 'b6', 9: '6', 10: 'b7', 11: '7'
    };

    const tuning = [4, 11, 7, 2, 9, 4]; // E B G D A E

    const scales = {
        major: [0, 2, 4, 5, 7, 9, 11],
        minor: [0, 2, 3, 5, 7, 8, 10],
        pentatonicMinor: [0, 3, 5, 7, 10],
        pentatonicMajor: [0, 2, 4, 7, 9],
        blues: [0, 3, 5, 6, 7, 10],
        harmoniqueMinor: [0, 2, 3, 5, 7, 8, 11],
        melodiqueMineur: [0, 2, 3, 5, 7, 9, 11]
    };

    const arpeggios = {
        major: [0, 4, 7],
        minor: [0, 3, 7],
        dominant7: [0, 4, 7, 10],
        maj7: [0, 4, 7, 11],
        min7: [0, 3, 7, 10]
    };

    const noteColors = {
        0: '#EF4444', 1: '#F97316', 2: '#FBBF24', 3: '#FCD34D',
        4: '#22C55E', 5: '#14B8A6', 6: '#06B6D4', 7: '#3B82F6',
        8: '#8B5CF6', 9: '#D946EF', 10: '#EC4899', 11: '#F43F5E'
    };

    // Helper functions
    function getKeyIndex(noteName) {
        return noteNames.universal.indexOf(noteName);
    }

    function getNotesByScale() {
        const keyIndex = getKeyIndex(state.selectedKey);
        const scaleIntervals = scales[state.selectedScale];
        return scaleIntervals.map(interval => (keyIndex + interval) % 12);
    }

    function getNotesByArpeggio() {
        const keyIndex = getKeyIndex(state.selectedKey);
        const arpeggioIntervals = arpeggios[state.selectedArpeggio];
        return arpeggioIntervals.map(interval => (keyIndex + interval) % 12);
    }

    function getVisibleNotes() {
        if (state.mode === 'scale') return getNotesByScale();
        if (state.mode === 'arpeggio') return getNotesByArpeggio();
        return state.selectedNotes.map(note => getKeyIndex(note));
    }

    // Initialize notes grid
    function initializeNotesGrid() {
        const grid = document.getElementById('notesGrid');
        grid.innerHTML = '';
        noteNames.universal.forEach((note, idx) => {
            const btn = document.createElement('button');
            btn.className = 'note-btn';

            if(state.notation === 'universal') btn.textContent = note;
            else if(state.notation === 'french') btn.textContent = noteNames.french[idx];
            else btn.textContent = intervalToDegree[idx];

            if(state.selectedNotes.includes(note)) {
                btn.style.backgroundColor = noteColors[idx];
                btn.style.color = 'white';
                btn.style.borderColor = noteColors[idx];
            } else {
                btn.style.backgroundColor = '#f5f7fa';
                btn.style.color = '#667eea';
                btn.style.borderColor = '#e0e0e0';
            }

            btn.onclick = () => toggleNote(note);
            grid.appendChild(btn);
        });
    }

    function toggleNote(note) {
        if(state.selectedNotes.includes(note)) {
            state.selectedNotes = state.selectedNotes.filter(n => n !== note);
        } else state.selectedNotes.push(note);
        initializeNotesGrid();
        updateFretboard();
    }

    // Update UI
    function updateModeUI() {
        const panel = document.querySelector('.control-panel');

        document.getElementById('scaleGroup').style.display = state.mode === 'scale' ? 'block' : 'none';
        document.getElementById('arpeggioGroup').style.display = state.mode === 'arpeggio' ? 'block' : 'none';
        document.getElementById('customNotesGroup').style.display = state.mode === 'custom' ? 'block' : 'none';
        document.getElementById('keyGroup').style.display = state.mode === 'custom' ? 'none' : 'block';

        const notationSelect = document.getElementById('notationSelect');
        Array.from(notationSelect.options).forEach(opt => {
            if(opt.value === 'degrees') opt.disabled = state.mode === 'custom';
        });
        if(state.notation === 'degrees' && state.mode === 'custom') {
            state.notation = 'universal';
            notationSelect.value = 'universal';
        }

        if(state.mode === 'custom') {
            panel.classList.add('custom-mode');
            initializeNotesGrid();
        } else {
            panel.classList.remove('custom-mode');
        }
    }

    function updateUI() {
        updateModeUI();
        updateFretboard();
    }

    // Event listeners
    document.getElementById('notationSelect').addEventListener('change', e => {
        state.notation = e.target.value;
        if(state.mode === 'custom') initializeNotesGrid();
        updateFretboard();
    });

    document.getElementById('modeSelect').addEventListener('change', e => {
        state.mode = e.target.value;

        // Si on passe en arpeggio et qu'aucun choix, on initialise
        if(state.mode === 'arpeggio' && !state.selectedArpeggio) state.selectedArpeggio = 'major';
        if(state.mode === 'scale' && !state.selectedScale) state.selectedScale = 'major';

        updateUI();
    });

    document.getElementById('scaleSelect').addEventListener('change', e => {
        state.selectedScale = e.target.value;
        updateFretboard();
    });

    document.getElementById('arpeggioSelect').addEventListener('change', e => {
        state.selectedArpeggio = e.target.value;
        updateFretboard();
    });

    document.getElementById('keySelect').addEventListener('change', e => {
        state.selectedKey = e.target.value;
        updateFretboard();
    });

    // Draw fretboard
    function updateFretboard() {
        const svg = document.getElementById('fretboard');
        svg.innerHTML = '';

        const visibleNotes = getVisibleNotes();

        const stringSpacing = 38;
        const firstStringY = 60;
        const lastStringY = firstStringY + (5 * stringSpacing);
        const neckPadding = 18;
        const fretCount = 15;
        const fretWidth = 48;
        const openStringX = 25;
        const startX = 50;
        const endX = startX + fretCount * fretWidth;

        // Neck
        const neck = document.createElementNS("http://www.w3.org/2000/svg","rect");
        neck.setAttribute("x", startX);
        neck.setAttribute("y", firstStringY - neckPadding);
        neck.setAttribute("width", endX - startX);
        neck.setAttribute("height", (lastStringY - firstStringY) + neckPadding*2);
        neck.setAttribute("fill","#7b4f2a");
        svg.appendChild(neck);

        // Strings
        for(let i=0;i<6;i++){
            const y = firstStringY + i * stringSpacing;
            const line = document.createElementNS('http://www.w3.org/2000/svg','line');
            line.setAttribute('x1', startX);
            line.setAttribute('y1', y);
            line.setAttribute('x2', endX);
            line.setAttribute('y2', y);
            line.setAttribute('stroke','#d0d0d0');
            line.setAttribute('stroke-width','3');
            svg.appendChild(line);
        }

        // String names
for(let i=0;i<6;i++){

    const noteIndex = tuning[i];
    let name;

    // IMPORTANT : toujours afficher le nom réel, jamais les degrés
    if(state.notation === 'french')
        name = noteNames.french[noteIndex];
    else
        name = noteNames.universal[noteIndex];

    const text = document.createElementNS('http://www.w3.org/2000/svg','text');

    text.setAttribute('x', 25);
    text.setAttribute('y', firstStringY + i * stringSpacing);

    text.setAttribute('text-anchor','middle');
    text.setAttribute('dominant-baseline','middle');

    text.setAttribute('fill','#ffffff');
    text.setAttribute('font-size','10');
    text.setAttribute('font-weight','bold');

    text.textContent = name;

    svg.appendChild(text);
}

        // Frets
        for(let i=0;i<=fretCount;i++){
            const x = startX + i * fretWidth;
            const line = document.createElementNS('http://www.w3.org/2000/svg','line');
            line.setAttribute('x1',x);
            line.setAttribute('y1',firstStringY - neckPadding);
            line.setAttribute('x2',x);
            line.setAttribute('y2',lastStringY + neckPadding);
            line.setAttribute('stroke','#c0c0c0');
            line.setAttribute('stroke-width',i===0?'5':'1.5');
            line.setAttribute('opacity',i===0?'1':'0.6');
            svg.appendChild(line);
        }

        // Fret numbers
for(let i=0;i<=fretCount;i++){

    const x = startX + i * fretWidth;

    const text = document.createElementNS('http://www.w3.org/2000/svg','text');

    text.setAttribute('x', x);
    text.setAttribute('y', firstStringY - neckPadding - 10);

    text.setAttribute('text-anchor','middle');

    text.setAttribute('fill','#ffffff');
    text.setAttribute('font-size','12');
    text.setAttribute('font-weight','bold');

    text.textContent = i;

    svg.appendChild(text);
}

        const tonicIndex = getKeyIndex(state.selectedKey);

        for(let s=0;s<6;s++){
            for(let f=-1;f<fretCount;f++){
                const noteIndex = (tuning[s]+(f+1))%12;
                if(f===-1 && !visibleNotes.includes(noteIndex)) continue;
                if(f>=0 && !visibleNotes.includes(noteIndex)) continue;

                const x = f===-1?openStringX:startX + f * fretWidth + fretWidth/2;
                const y = firstStringY + s * stringSpacing;
                let noteName = '';
                if(state.notation==='universal') noteName = noteNames.universal[noteIndex];
                else if(state.notation==='french') noteName = noteNames.french[noteIndex];
                else noteName = intervalToDegree[(noteIndex - tonicIndex + 12)%12];

                const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
                circle.setAttribute('cx',x);
                circle.setAttribute('cy',y);
                circle.setAttribute('r',14);
                circle.setAttribute('fill',noteColors[noteIndex]);
                circle.setAttribute('filter','drop-shadow(0 2px 4px rgba(0,0,0,0.2))');
                svg.appendChild(circle);

                if(state.mode!=='custom' && noteIndex===tonicIndex){
                    const outline = document.createElementNS('http://www.w3.org/2000/svg','circle');
                    outline.setAttribute('cx',x);
                    outline.setAttribute('cy',y);
                    outline.setAttribute('r',16);
                    outline.setAttribute('fill','none');
                    outline.setAttribute('stroke','white');
                    outline.setAttribute('stroke-width','2');
                    svg.appendChild(outline);
                }

                const text = document.createElementNS('http://www.w3.org/2000/svg','text');
                text.setAttribute('x',x);
                text.setAttribute('y',y);
                text.setAttribute('text-anchor','middle');
                text.setAttribute('dominant-baseline','middle');
                text.setAttribute('fill','white');
                text.setAttribute('font-size','10');
                text.setAttribute('font-weight','bold');
                text.textContent = noteName;
                svg.appendChild(text);
            }
        }
    }

    // Initialize
    updateUI();
</script>
</body>
</html>